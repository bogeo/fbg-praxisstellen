    <!-- FONTAWESOME -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
        crossorigin="" />

    <!-- leaflet dependencies -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.1/dist/leaflet.css" crossorigin="" />

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.1/dist/leaflet.js" crossorigin=""></script>

    <!-- leaflet markercluster -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" crossorigin="" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"
        crossorigin="" />
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js" crossorigin=""></script>

    <!-- leaflet search -->
    <script src="https://unpkg.com/leaflet-search@3.0.2/dist/leaflet-search.min.js" crossorigin=""></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-search@3.0.3/dist/leaflet-search.min.css" crossorigin="" />

    
<!-- own stylesheet -->
    <style>
        #mapContainer {
            height: 50vH;
        }

        .red {
            color: #E2001A;
        }

        .green {
            color: green;
            font-size: 12px !important;
        }

        .blue {
            color: #146EBE;
        }

        .white {
            color: white;
        }

        #mapContainer .icon {

            width: 15px;
            height: 15px;
            float: left;
            margin-right: 5px;
            margin-top: 2px;
        }

        .icon-blue {
            color: #146EBE;
            background-color: #146EBE;
            background: #146EBE;
        }

        .icon-red {
            color: #E2001A;
            background-color: #E2001A;
            background: #E2001A;
        }

        .icon-green {
            color: green;
            background-color: green;
            background: green;
        }

        .bg-blue {
            color: antiquewhite;
            background-color: rgba(20, 110, 190, 0.6) !important;
            background: rgba(20, 110, 190, 0.6) !important;
        }

        .bg-green {
            color: antiquewhite;
            background-color: rgba(0, 128, 0, 0.6) !important;
            background: rgba(0, 128, 0, 0.6) !important;
        }

        .bg-red {
            color: antiquewhite;
            background-color: rgba(226, 0, 26, 0.6) !important;
            background: rgba(226, 0, 26, 0.6) !important;
        }

        .featurePropertyPopupContent {
            font-size: 11px;
            max-width: 300px;
            max-height: 300px;
            overflow: auto;
        }


        /* TOGGLE SWITCH */

        /* The switch - the box around the slider */

        #clusterToggle {
            position: absolute;
            top: 10px;
            left: 100px;
            z-index: 9999;
            color: #ccc;
            background-color: rgba(233, 233, 233, 0.5);
            color: black;
            display: flex;
            flex-direction: row;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        /* Hide default HTML checkbox */
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* The slider */
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked+.slider {
            background-color: #2196F3;
        }

        input:focus+.slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked+.slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }
    </style>

    <!-- empty map container div - will be filled later as interactive map -->

    <div id="mapContainer"></div>

    <div id="clusterToggle">
        <b><i>Punktmarker clustern? &nbsp;&nbsp;</i></b>
        <label class="switch">
            <input type="checkbox" id="clusterToggleSwitch">
            <span class="slider round"></span>
        </label>
    </div>

    <!-- own javascript -->
    <script>

var geoJSON = {
	"type":"FeatureCollection", 
	"features":[
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Hanack und Partner Vermessung", 
				"Abteilung":"", 
				"Straße":"Langenhorst  1",
				"PLZ":"22453", 
				"Ort":"Hamburg", 
				"Webseite":"www.hanackundpartner.de", 
				"Kontakt":"Dipl.-Ing. Schmidt-Böllert", 
				"Tel":"", 
				"E-Mail":""
			}, 
			"geometry":{
				"coordinates":["9.955679921312282", "53.60990355"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		},
		{
			"type":"Feature", 
			"properties":{
				"Firma":"AIRBUS Deutschland GmbH", 
				"Abteilung":"QS-Messtechnik TRSQ51", 
				"Straße":"Kreetslag 10", 
				"PLZ":"21129", 
				"Ort":"Hamburg", 
				"Webseite":"www.airbus.com/de", 
				"Kontakt":"Dipl.-Ing. Drohne", 
				"Tel":"+49 40 743-73395", 
				"E-Mail":"uwe.drohne@airbus.com "
			
			}, 
			"geometry":{
				"coordinates":["9.8470459", "53.537613"], 
				"type":"Point"			
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Hamburg Port Authority AöR (HPA)", 
				"Abteilung":"Zentrale Dienste HPA 5430-2", 
				"Straße":"Neuer Wandrahm 4", 
				"PLZ":"20457", 
				"Ort":"Hamburg", 
				"Webseite":"www.hamburg-port-authority.de/de/", 
				"Kontakt":"Ivonne Staffen", 
				"Tel":"", 
				"E-Mail":"ivonne.staffen@hpa.hamburg.de"
			}, 
			"geometry":{
				"coordinates":["9.9954396", "53.5449315"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Hamburg Port Authority AöR (HPA)", 
				"Abteilung":"Peil- und Vermessungsdienst", 
				"Straße":"Neuer Wandrahm 4", 
				"PLZ":"20457", 
				"Ort":"Hamburg", 
				"Webseite":"www.hamburg-port-authority.de/de/", 
				"Kontakt":"Dieter Seefeld", 
				"Tel":"", 
				"E-Mail":"dieter.seefeld@hpa.hamburg.de"
			}, 
			"geometry":{
				"coordinates":["9.9954396", "53.5449315"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Öffentlich bestellte Vermessungsingenieure Ludwig & Schwefer", 
				"Abteilung":"", 
				"Straße":"Feldmühlenweg 18", 
				"PLZ":"59494", 
				"Ort":"Soest", 
				"Webseite":"www.ls-soest.de/oebvi/home/", 
				"Kontakt":"Dipl.-Ing. Schwefer", 
				"Tel":"", 
				"E-Mail":""
			}, 
			"geometry":{
				"coordinates":["8.096591187346798", "51.575316099999995"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Angermeier Ingenieure GmbH", 
				"Abteilung":"Büro Ruhrgebiet", 
				"Straße":"Europaplatz 2", 
				"PLZ":"44269", 
				"Ort":"Dortmund", 
				"Webseite":"www.angermeier.de/", 
				"Kontakt":"Christian Bigos", 
				"Tel":"+49 231 98887973", 
				"E-Mail":"ruhrgebiet@angermeier.de"
			}, 
			"geometry":{
				"coordinates":["7.523084448461539", "51.50211315"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Stadtwerke Düsseldorf AG", 
				"Abteilung":"Rekrutierung", 
				"Straße":"Höherweg 100", 
				"PLZ":"40533", 
				"Ort":"Düsseldorf", 
				"Webseite":"www.swd-ag.de/ueber-uns/jobs-karriere", 
				"Kontakt":"Sabine Brans", 
				"Tel":"+49 211 821-2216", 
				"E-Mail":"sbrans@swd-ag.de"
			}, 
			"geometry":{
				"coordinates":["6.81301", "51.222639"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Be-Mo Tunneling GmbH", 
				"Abteilung":"Vermessung / Messtechnik", 
				"Straße":"Westfalendamm 72", 
				"PLZ":"44141", 
				"Ort":"Dortmund", 
				"Webseite":"www.bemo.net", 
				"Kontakt":"Dipl.-Ing. Ulf Tetzlaff", 
				"Tel":"+49 231 589839-35", 
				"E-Mail":"ulf.tetzlaff@bemo.net"
			}, 
			"geometry":{
				"coordinates":["7.4882062499999975", "51.50226295"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Öff.best.-Verm.-Ing. Dipl.-Ing. Rudolf Wehmeyer", 
				"Abteilung":"", 
				"Straße":"Grevener Str. 75", 
				"PLZ":"48147", 
				"Ort":"Münster", 
				"Webseite":"www.vermessungsbuero-wehmeyer.de", 
				"Kontakt":"Dipl.-Ing. Rudolf Wehmeyer", 
				"Tel":"+49 251 20135-0", 
				"E-Mail":"Wehmeyer@vermessungsbuero-wehmeyer.de"
			}, 
			"geometry":{
				"coordinates":["7.6124323", "51.9743489"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Dr. Hesse und Partner Ingenieure", 
				"Abteilung":"", 
				"Straße":"Veritaskai 6", 
				"PLZ":"21079", 
				"Ort":"Hamburg", 
				"Webseite":"www.dhpi.com", 
				"Kontakt":"Dr.-Ing. Christian Hesse", 
				"Tel":"+49 40 52299190-20", 
				"E-Mail":"ch@dhpi.com"
			}, 
			"geometry":{
				"coordinates":["9.9882463", "53.465661"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"sigma3D GmbH", 
				"Abteilung":"", 
				"Straße":"Marie-Curie-Str. 2", 
				"PLZ":"48712", 
				"Ort":"Gescher", 
				"Webseite":"www.sigma3D.de", 
				"Kontakt":"Dipl.-Ing. Mönsters", 
				"Tel":"+49 2542 918 98-093", 
				"E-Mail":"moensters@sigma3D.de"
			}, 
			"geometry":{
				"coordinates":["7.021393314017843", "51.94199055"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"MEYER Werft GmbH", 
				"Abteilung":"Vermessung", 
				"Straße":"Industriegebiet Süd", 
				"PLZ":"26871", 
				"Ort":"Papenburg", 
				"Webseite":"www.meyerwerft.de", 
				"Kontakt":"Dipl.-Ing. Ralph Zimmermann", 
				"Tel":"", 
				"E-Mail":"ralph.zimmermann@meyerwerft.de"
			}, 
			"geometry":{
				"coordinates":["7.3652363", "53.0929848"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"HOCHTIEF Solutions AG", 
				"Abteilung":"Civil Engineering and Tunneling", 
				"Straße":"Zeche Ernestine 27-29", 
				"PLZ":"45141", 
				"Ort":"Essen", 
				"Webseite":"www.hochtief.de", 
				"Kontakt":"Civil Engineering and Tunneling", 
				"Tel":"", 
				"E-Mail":"wolfgang.hicking@hochtief.de"
			}, 
			"geometry":{
				"coordinates":["7.0467556", "51.4714852"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Heitkamp Ingenieur- und Kraftwerksbau GmbH", 
				"Abteilung":"Kompetenzcenter Ingenieurvermessung", 
				"Straße":"Dammstr. 7", 
				"PLZ":"44145", 
				"Ort":"Dortmund", 
				"Webseite":"", 
				"Kontakt":"Dipl. Ing Achim Hoffstiepel", 
				"Tel":"+49 231 99953-120", 
				"E-Mail":"achim.hoffstiepel@heitkamp-ikb.com"
			}, 
			"geometry":{
				"coordinates":["7.471571310617244", "51.526396202599514"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Ingenieurbüro Herzbruch GmbH", 
				"Abteilung":"", 
				"Straße":"Wilhelmstr. 41", 
				"PLZ":"58332", 
				"Ort":"Schwelm", 
				"Webseite":"www.ibh-vermessung.de", 
				"Kontakt":"Dipl.-Ing. Frank Herzbruch", 
				"Tel":"", 
				"E-Mail":""
			}, 
			"geometry":{
				"coordinates":["7.2957484", "51.2898043"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"VTW Vermessungstechnik West GmbH", 
				"Abteilung":"", 
				"Straße":"Ruhrtalstr. 93", 
				"PLZ":"45239", 
				"Ort":"Essen", 
				"Webseite":"www.vtw-gmbh.de", 
				"Kontakt":"Philipp Landa", 
				"Tel":"+49 201 384489-21", 
				"E-Mail":""
			}, 
			"geometry":{
				"coordinates":["6.983901", "51.381489"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": "250996"
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"MARX Ingenieurgesellschaft mbH", 
				"Abteilung":"", 
				"Straße":"Erlenstraße 65", 
				"PLZ":"46149", 
				"Ort":"Oberhausen", 
				"Webseite":"http://www.marx-ig.de/de/kontakt.html", 
				"Kontakt":"A. Suding", 
				"Tel":"+49 208 69978-0", 
				"E-Mail":"a.suding@marx-ig.de"
			}, 
			"geometry":{
				"coordinates":["6.822221659217611", "51.52029695"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Wupperverband", 
				"Abteilung":"Vermessung / Planmanagement / CAD", 
				"Straße":"Untere Lichtenplatzer Str. 100", 
				"PLZ":"42289", 
				"Ort":"Wuppertal", 
				"Webseite":"www.wupperverband.de", 
				"Kontakt":"Achim Schraven", 
				"Tel":"+49 202 583-329", 
				"E-Mail":"schr@wupperverband.de"
			}, 
			"geometry":{
				"coordinates":["7.203414905694332", "51.26614985"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"GEOHAUS - Haus der Geoinformation", 
				"Abteilung":"", 
				"Straße":"Löhberg 78", 
				"PLZ":"45468", 
				"Ort":"Mülheim an der Ruhr", 
				"Webseite":"www.geohaus.de", 
				"Kontakt":"Hanns-Florian Schuster", 
				"Tel":"", 
				"E-Mail":"hfs@geohaus.de"
				}, 
				"geometry":{
				"coordinates":["6.879599142950334", "51.4296143"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"DB International GmbH", 
				"Abteilung":"Umwelt", 
				"Straße":" Geotechnik & Geodäsie (I.TPU)", 
				"PLZ":"Zum Portsmouthplatz 6", 
				"Ort":"47051", 
				"Webseite":"Duisburg", 
				"Kontakt":"www.db-international.de", 
				"Tel":"Oliver Junghans", 
				"E-Mail":"+49 203 987152-50"
			}, 
			"geometry":{
				"coordinates":["6.773008", "51.429157"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Landesbetrieb Straßenbau NRW", 
				"Abteilung":"Vermessung/Straßeninformationssysteme", 
				"Straße":"Harpener Hellweg 1", 
				"PLZ":"44791", 
				"Ort":"Bochum", 
				"Webseite":"strassen.nrw.de", 
				"Kontakt":"Ulrich Küting", 
				"Tel":"+49 234 9552-123", 
				"E-Mail":"Ulrich.Kueting@strassen.nrw.de"
			}, 
			"geometry":{
				"coordinates":["7.254532410619303", "51.49411135"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Glückauf-Vermessung GmbH ", 
				"Abteilung":"", 
				"Straße":"Salzstraße 10", 
				"PLZ":"99706", 
				"Ort":"Sondershausen", 
				"Webseite":"www.glueckauf-vermessung.de", 
				"Kontakt":"Mario Haupt", 
				"Tel":"+49 3632 7104-20", 
				"E-Mail":"info@glueckauf-vermessung.de"
			}, 
			"geometry":{
				"coordinates":["10.8356167", "51.3910922"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"RMK", 
				"Abteilung":"", 
				"Straße":"Breite Straße 32", 
				"PLZ":"29221", 
				"Ort":"Celle", 
				"Webseite":"www.rmkconsult.de", 
				"Kontakt":"Christoph Crause", 
				"Tel":"", 
				"E-Mail":"Christoph.crause@rmkconsult.de"
			}, 
			"geometry":{
				"coordinates":["10.072224727178218", "52.619639899999996"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Ingenieurbüro Fritz P. Kallert", 
				"Abteilung":"", 
				"Straße":"Kurt-Schumacher-Str. 265", 
				"PLZ":"46539", 
				"Ort":"Dinslaken", 
				"Webseite":"www.kallert.de", 
				"Kontakt":"", 
				"Tel":"+49 2064 49033", 
				"E-Mail":"info.kallert@kallert.de"
			}, 
			"geometry":{
				"coordinates":["6.794383", "51.560325"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Rheinbahn AG", 
				"Abteilung":"Team Vermessung", 
				"Straße":"Hansaallee 1", 
				"PLZ":"40549", 
				"Ort":"Düsseldorf", 
				"Webseite":"www.rheinbahn.de", 
				"Kontakt":"Stefan Szarka", 
				"Tel":"+49 211 5821225", 
				"E-Mail":"stefan.szarka@rheinbahn.de"
			}, 
			"geometry":{
				"coordinates":["6.742642147184755", "51.234273849999994"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Vermessungsbüro Wetterhahn", 
				"Abteilung":"", 
				"Straße":"Gärtnerstraße 42", 
				"PLZ":"45128", 
				"Ort":"Essen", 
				"Webseite":"www.wetterhahn-online.de", 
				"Kontakt":"", 
				"Tel":"+49 201 365890", 
				"E-Mail":"info@wetterhahn-online.de"
			}, 
			"geometry":{
				"coordinates":["7.018118273470657", "51.44640065"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"ÖbVI Büro Marx - Henkys", 
				"Abteilung":"", 
				"Straße":"Bahnhofstr. 57", 
				"PLZ":"46145", 
				"Ort":"Oberhausen", 
				"Webseite":"www.marx-ig.de/", 
				"Kontakt":"", 
				"Tel":"+49 208 6355900", 
				"E-Mail":"VB.Marx@t-online.de"
			}, 
			"geometry":{
				"coordinates":["6.850064", "51.515849"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Öffentlich bestellte Vermessungsingenieure (ÖbVI) PILHATSCH INGENIEURE", 
				"Abteilung":"", 
				"Straße":"Rüngsdorfer Str. 6", 
				"PLZ":"53173", 
				"Ort":"Bonn", 
				"Webseite":"www.pilhatsch-geo.de", 
				"Kontakt":"", 
				"Tel":"+49 228 30862-0", 
				"E-Mail":"info@pilhatsch-geo.de"
			}, 
			"geometry":{
				"coordinates":["7.162254798049908", "50.6848094"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": "250778"
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"ÖbVI Rose", 
				"Abteilung":"", 
				"Straße":"Königsberger Straße 22", 
				"PLZ":"57462", 
				"Ort":"Olpe", 
				"Webseite":"www.oebvi-rose.de", 
				"Kontakt":"Bernd Flashove", 
				"Tel":"+49 2761 93960", 
				"E-Mail":"info@oebvi-rose.de"
			}, 
			"geometry":{
				"coordinates":["7.837748123596256", "51.02698185"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Netzgesellschaft Düsseldorf", 
				"Abteilung":"", 
				"Straße":"Höherweg 200", 
				"PLZ":"40233", 
				"Ort":"Düsseldorf", 
				"Webseite":"www.netz-duesseldorf.de", 
				"Kontakt":"Dipl.-Ing. Hubert Graffmann", 
				"Tel":"+49 211 8218538", 
				"E-Mail":"hgraffmann@netz-duesseldorf.de"
			}, 
			"geometry":{
				"coordinates":["6.8168385943997265", "51.2226026"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Ingenieurbüro Bertels", 
				"Abteilung":"", 
				"Straße":"Fridtjof-Nansen-Weg 7", 
				"PLZ":"48155", 
				"Ort":"Münster", 
				"Webseite":"www.bertels-info.de", 
				"Kontakt":"", 
				"Tel":"+49 251 60985 - 0", 
				"E-Mail":"muenster@bertels-info.de"
			}, 
			"geometry":{
				"coordinates":["7.657134127590196", "51.9342793"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": "250777"
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Vermessungsbüro Dipl. Ing. Hagen Lenzke (ÖbVI)", 
				"Abteilung":"", 
				"Straße":"Jülicher Straße 213", 
				"PLZ":"52070", 
				"Ort":"Aachen", 
				"Webseite":"www.vermessung-aachen.de", 
				"Kontakt":"", 
				"Tel":"+49 241 65066", 
				"E-Mail":"info@vermessung-aachen.de"
			}, 
			"geometry":{
				"coordinates":["6.110124276404054", "50.785283"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"ÖbVI PETERSEN", 
				"Abteilung":"", 
				"Straße":"Hagenstraße 7", 
				"PLZ":"45894", 
				"Ort":"Gelsenkirchen", 
				"Webseite":"www.oebvi-petersen.de", 
				"Kontakt":"Miriam Bergall", 
				"Tel":"+49 209 60971-41", 
				"E-Mail":"miriam.begall@oebvi-petersen.de"
			}, 
			"geometry":{
				"coordinates":["7.0515074490415275", "51.57751843019183"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": "250776"
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Ministerium des Innern des Landes Nordrhein-Westfalen", 
				"Abteilung":"Referat 37", 
				"Straße":"", 
				"PLZ":"40190", 
				"Ort":"Düsseldorf", 
				"Webseite":"", 
				"Kontakt":"", 
				"Tel":"", 
				"E-Mail":"referat37@im.nrw.de"
			}, 
			"geometry":{
				"coordinates":["6.777769358861549", "51.213628845312726"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": "250779"
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Jens Janßen Ingenieurbüro", 
				"Abteilung":"", 
				"Straße":"In der Illekatte 1", 
				"PLZ":"58339", 
				"Ort":"Breckerfeld", 
				"Webseite":"www.jensjanssen.de", 
				"Kontakt":"Jannik Janssen", 
				"Tel":"02338-9198-0", 
				"E-Mail":"jannik.janssen@jensjanssen.de"
			}, 
			"geometry":{
				"coordinates":["7.46666089388925", "51.265853473869065"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": "250780"
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"ESRI Deutschland GmbH", 
				"Abteilung":"", 
				"Straße":"Ringstraße 7", 
				"PLZ":"85402", 
				"Ort":"Kranzberg", 
				"Webseite":"www.esri.de", 
				"Kontakt":"", 
				"Tel":"", 
				"E-Mail":"f.bechen@esri.de"
			}, 
			"geometry":{
				"coordinates":["11.609194175419379", "48.406476698718144"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"con terra GmbH", 
				"Abteilung":"", 
				"Straße":"Martin-Luther-King-Weg 20", 
				"PLZ":"48155", 
				"Ort":"Münster", 
				"Webseite":"www.conterra.de", 
				"Kontakt":"", 
				"Tel":"+49 0251 59689-300", 
				"E-Mail":"r.abke@conterra.de"
			}, 
			"geometry":{
				"coordinates":["7.652600981667087", "51.93511434990086"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": "253051"
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"TRIOPT Group", 
				"Abteilung":"", 
				"Straße":"Alexander-Bell-Straße 19", 
				"PLZ":"47445", 
				"Ort":"Moers", 
				"Webseite":"www.triopt.de/", 
				"Kontakt":"Eileen Kumutat", 
				"Tel":"", 
				"E-Mail":"Eileen.Kumutat@triopt-group.de"
			}, 
			"geometry":{
				"coordinates":["6.59440", "51.47210"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"VertiGIS", 
				"Abteilung":"", 
				"Straße":"Wendenstr. 8-12", 
				"PLZ":"20097", 
				"Ort":"Hamburg", 
				"Webseite":"www.vertigis.com/de/", 
				"Kontakt":"", 
				"Tel":"", 
				"E-Mail":""
			}, 
			"geometry":{
				"coordinates":["10.025833258296087", "53.54689112372327"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"imp GmbH", 
				"Abteilung":"", 
				"Straße":"Im Neyl 18", 
				"PLZ":"59823", 
				"Ort":"Arnsberg", 
				"Webseite":"www.imp-gmbh.de/de/", 
				"Kontakt":"Michael Pomberg", 
				"Tel":"+49 02937 829659", 
				"E-Mail":"michael.pomberg@imp-gmbh.de"
			}, 
			"geometry":{
				"coordinates":["8.122772445045191", "51.38956120010465"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Atos Informations Technology GmbH", 
				"Abteilung":"", 
				"Straße":"Ahornallee 9", 
				"PLZ":"33106", 
				"Ort":"Paderborn", 
				"Webseite":"www.atos.net/de/deutschland", 
				"Kontakt":"Karl-Heinz Boehm", 
				"Tel":"", 
				"E-Mail":"karl-heinz.boehm@atos.net"
			}, 
			"geometry":{
				"coordinates":["8.716472386493132", "51.72171637272807"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"PLEdoc GmbH", 
				"Abteilung":"", 
				"Straße":"Gladbecker Str. 404", 
				"PLZ":"45326", 
				"Ort":"Essen", 
				"Webseite":"www.pledoc.de/", 
				"Kontakt":"Christian Frank", 
				"Tel":"+49 0201 3642-14679", 
				"E-Mail":"christian.frank@pledoc.de"
			}, 
			"geometry":{
				"coordinates":["7.0002314568222355", "51.48733053226651"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"52 North Spatial Information Research GmbH", 
				"Abteilung":"", 
				"Straße":"Martin-Luther-King-Weg 24", 
				"PLZ":"48155", 
				"Ort":"Muenster", 
				"Webseite":"www.52north.org/", 
				"Kontakt":"", 
				"Tel":"", 
				"E-Mail":"jirka@52north.org"
			}, 
			"geometry":{
				"coordinates":["7.652064233288637", "51.93504313494248"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Vermessungsbüro Drerup", 
				"Abteilung":"", 
				"Straße":"Nonnenwall 2", 
				"PLZ":"48249", 
				"Ort":"Dülmen", 
				"Webseite":"www.drerup.de/", 
				"Kontakt":"Julian Drerup", 
				"Tel":"+49 02594 84848", 
				"E-Mail":"julian@drerup.de"
			}, 
			"geometry":{
				"coordinates":["7.280704492642015", "51.828487995369244"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Bez.reg. Köln, Geobasis.NRW", 
				"Abteilung":"", 
				"Straße":"Zeughausstraße 2-10", 
				"PLZ":"50667", 
				"Ort":"Köln", 
				"Webseite":"www.bezreg-koeln.nrw.de/brk_internet/geobasis/index.html", 
				"Kontakt":"Marco Östereich", 
				"Tel":"", 
				"E-Mail":"marco.oestereich@bezreg-koeln.nrw.de"
			}, 
			"geometry":{
				"coordinates":["6.948435444466288", "50.94137495463053"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"VisDat GmbH", 
				"Abteilung":"", 
				"Straße":"Am Ende 14", 
				"PLZ":"1277", 
				"Ort":"Dresden", 
				"Webseite":"www.visdat.de/", 
				"Kontakt":"Micha Gebel", 
				"Tel":"", 
				"E-Mail":"micha.gebel@visdat.de"
			}, 
			"geometry":{
				"coordinates":["13.792061971775597", "51.03349951452891"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"IP SYSCON GmbH", 
				"Abteilung":"", 
				"Straße":"Tiestestr. 16-18", 
				"PLZ":"30171", 
				"Ort":"Hannover", 
				"Webseite":"www.ipsyscon.de", 
				"Kontakt":"Isabelle Poppe-Gierse", 
				"Tel":"", 
				"E-Mail":"isabelle.poppe-gierse@ipsyscon.de"
			}, 
			"geometry":{
				"coordinates":["9.760913347411384", "52.36451991435991"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Nahverkehrsgesellschaft Baden-Württemberg mbH", 
				"Abteilung":"", 
				"Straße":"Wilhelmsplatz 11", 
				"PLZ":"70182", 
				"Ort":"Stuttgart", 
				"Webseite":"www.nvbw.de", 
				"Kontakt":"Anja Kneer", 
				"Tel":"", 
				"E-Mail":"Anja.Kneer@nvbw.de"
			}, 
			"geometry":{
				"coordinates":["9.17742416381108", "48.770901727182654"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"VMZ Berlin Betreibergesellschaft mbH", 
				"Abteilung":"", 
				"Straße":"Ullsteinstraße 120", 
				"PLZ":"12109", 
				"Ort":"Berlin", 
				"Webseite":"www.vmzberlin.com", 
				"Kontakt":"Jan Kätker", 
				"Tel":"", 
				"E-Mail":"jan.kaetker@vmzberlin.com"
			}, 
			"geometry":{
				"coordinates":["13.386213881022236", "52.453176657991506"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"PRISMA solutions EDV-Dienstleitungen GmbH", 
				"Abteilung":"", 
				"Straße":"Klostergasse 18", 
				"PLZ":"2340", 
				"Ort":"Mödling, Österreich", 
				"Webseite":"www.prisma-solutions.com", 
				"Kontakt":"Florian Hilti", 
				"Tel":"", 
				"E-Mail":"florian.hilti@prisma-solutions.com"
			}, 
			"geometry":{
				"coordinates":["16.285675097062434", "48.0863108628437"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"ITS Informationstechnik Service GmbH", 
				"Abteilung":"", 
				"Straße":"Phoenixseestraße 6", 
				"PLZ":"44263", 
				"Ort":"Dortmund", 
				"Webseite":"www.its-service.de", 
				"Kontakt":"Micro Schiffler", 
				"Tel":"+49 0231 22249228", 
				"E-Mail":"mirco.schiffler@its-service.de"
			}, 
			"geometry":{
				"coordinates":["7.508807570811773", "51.48890038538021"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Vitronet", 
				"Abteilung":"", 
				"Straße":"Zeche Katharina 2", 
				"PLZ":"45307", 
				"Ort":"Essen", 
				"Webseite":"www.vitronet.de/", 
				"Kontakt":"Julia Thomson", 
				"Tel":"", 
				"E-Mail":"Julia.Thomson@vitronet.de"
			}, 
			"geometry":{
				"coordinates":["7.0574436201195505", "51.45675594592581"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"IT NRW", 
				"Abteilung":"", 
				"Straße":"Hamborner Straße 51", 
				"PLZ":"40472", 
				"Ort":"Düsseldorf", 
				"Webseite":"www.it.nrw/", 
				"Kontakt":"Christoph Rath", 
				"Tel":"+49 0211 9449-3101", 
				"E-Mail":"christoph.rath@it.nrw.de"
			}, 
			"geometry":{
				"coordinates":["6.789728658082514", "51.2766327908524"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": "252347"
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Stadt Gelsenkirchen", 
				"Abteilung":"", 
				"Straße":"Ebertstraße 11", 
				"PLZ":"45879", 
				"Ort":"Gelsenkirchen", 
				"Webseite":"www.gelsenkirchen.de", 
				"Kontakt":"Nils Rosenberg", 
				"Tel":"+49 0209 1694890", 
				"E-Mail":"nils.rosenberg@gelsenkirchen.de"
			}, 
			"geometry":{
				"coordinates":["7.093653480190893", "51.51026959149488"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Kreis Warendorf", 
				"Abteilung":"", 
				"Straße":"Waldenburger Str. 2", 
				"PLZ":"48231", 
				"Ort":"Warendorf", 
				"Webseite":"www.kreis-warendorf.de/unsere-themen/geoinformation-und-kataster", 
				"Kontakt":"Jens Hinrichs", 
				"Tel":"+49 02581 536200", 
				"E-Mail":"jens.hinrichs@kreis-warendorf.de"
			}, 
			"geometry":{
				"coordinates":["7.985288585803986", "51.94144635473379"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Ennepe-Ruhr-Kreis", 
				"Abteilung":"", 
				"Straße":"Hauptstraße 92", 
				"PLZ":"58332", 
				"Ort":"Schwelm", 
				"Webseite":"www.enkreis.de", 
				"Kontakt":"Markus Rembold", 
				"Tel":"+49 02336 932378", 
				"E-Mail":"M.Rembold@en-kreis.de"
			}, 
			"geometry":{
				"coordinates":["7.2985321612242515", "51.28502172168582"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		}, 
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Stadt Herne", 
				"Abteilung":"", 
				"Straße":"Postfach 101820", 
				"PLZ":"44621", 
				"Ort":"Herne", 
				"Webseite":"www.herne.de", 
				"Kontakt":"Anja Siegesmund", 
				"Tel":"", 
				"E-Mail":"Anja.Sigesmund@herne.de"
			}, 
			"geometry":{
				"coordinates":["7.166213824065282", "51.525669564218695"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		},
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Vermessungsbüro Rox und Mertens", 
				"Abteilung":"", 
				"Straße":"Heinrich-Horten-Straße 1",
				"PLZ":"47906", 
				"Ort":"Kempen", 
				"Webseite":"www.roxmertens.de", 
				"Kontakt":"", 
				"Tel":"02152 14480", 
				"E-Mail":""
			}, 
			"geometry":{
				"coordinates":["6.43943", "51.36524"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		},
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Geotechnik GmbH", 
				"Abteilung":"", 
				"Straße":"Heinrich-Horten-Straße 1",
				"PLZ":"47906", 
				"Ort":"Kempen", 
				"Webseite":"www.geotechnik-kempen.de", 
				"Kontakt":"", 
				"Tel":"02152 20310", 
				"E-Mail":""
			}, 
			"geometry":{
				"coordinates":["6.61885", "49.74868"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		},
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Geotechnik GmbH", 
				"Abteilung":"", 
				"Straße":"Eurener Straße 33",
				"PLZ":"54294", 
				"Ort":"Trier", 
				"Webseite":"www.geotechnik-kempen.de", 
				"Kontakt":"", 
				"Tel":"0651 9981080", 
				"E-Mail":""
			}, 
			"geometry":{
				"coordinates":["6.43943", "51.36524"], 
				"type":"Point"
			},
			"label":{
				"study":["Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		},
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Landwirtschaftliches Technologiezentrum Augustenberg", 
				"Abteilung":"Ref. 11 (Pflanzenbau, Digitalisierung)", 
				"Straße":"Kutschenweg 20",
				"PLZ":"76287", 
				"Ort":"Rheinstetten", 
				"Webseite":"http://www.LTZ-Augustenberg.de", 
				"Kontakt":"Dr. Martin Weis", 
				"Tel":"0174 4941017", 
				"E-Mail":"martin.weis@ltz.bwl.de"
			}, 
			"geometry":{
				"coordinates":["8.3330605", "48.9656514"], 
				"type":"Point"
			},
			"label":{
				"study":["Geoinformatik", "Vermessung"],
				"topic":[]
			},
			"moodlePageId": ""
		},
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Landesamt für Geoinformation und Landentwicklung Baden-Württemberg", 
				"Abteilung":"", 
				"Straße":"Büchsenstraße 54",
				"PLZ":"70174", 
				"Ort":"Stuttgart", 
				"Webseite":"", 
				"Kontakt":"Christiane Dworak", 
				"Tel":"+49 711 95980 – 168", 
				"E-Mail":"christiane.dworak@lgl.bwl.de"
			}, 
			"geometry":{
				"coordinates":["9.1685515", "48.7794898"], 
				"type":"Point"
			},
			"label":{
				"study":["Geoinformatik"],
				"topic":[]
			},
			"moodlePageId": ""
		},
		{
			"type":"Feature", 
			"properties":{
				"Firma":"Regierungspräsidium Freiburg", 
				"Abteilung":" Forstliche Geoinformation", 
				"Straße":"Bertoldstraße 43",
				"PLZ":"79098", 
				"Ort":"Freiburg i. Br.", 
				"Webseite":"https://rp.baden-wuerttemberg.de/rpf/", 
				"Kontakt":"Susanne Berger", 
				"Tel":"+49 761 208-1314", 
				"E-Mail":"Susanne.Berger@rpf.bwl.de"
			}, 
			"geometry":{
				"coordinates":["7.8452957", "47.9959546"], 
				"type":"Point"
			},
			"label":{
				"study":["Geoinformatik"],
				"topic":[]
			},
			"moodlePageId": ""
		}
	]
};


       var mapContainerNodeId = "mapContainer";
var linkToJsonFile = "./resources/praxis.json";
// var linkToJsonFile = "http://localhost:8000/resources/praxis.json";
var useCluster = true;
var clusterToggleSwitchId = "clusterToggleSwitch";

const study_surveilling = "Vermessung";
const study_geoinformatics = "Geoinformatik";
const property_company = "Firma";
const moodlePageId = "moodlePageId";
const moodlePageId_label = "Weitere Informationen";
const moodlePageId_baseUrl = "https://moodle.hs-bochum.de/mod/page/view.php?id=";
const property_postcode = "PLZ";
const property_street = "Straße";
const property_city = "Ort";
const property_address = "Adresse";

const style_class_surveilling = "blue"; // red, green, blue
const style_class_geoinformatics = "green"; // red, green, blue
const style_class_careerDay = "red"; // red, green, blue

const label_layer_surveilling = "Praxisstellen - Studiengang Vermessung " + "<i class='icon icon-" + style_class_surveilling + "'></i>";
const label_layer_geoinformatics = "Praxisstellen - Studiengang Geoinformatik " + "<i class='icon icon-" + style_class_geoinformatics + "'></i>";
const label_layer_careerDay = "Praxisstellen - Career Day " + "<i class='icon icon-" + style_class_careerDay + "'></i>";

var overlayLayersArray = [];

var map;
var layerControl;
var searchControl;

const MultipleResultsLeafletSearch = L.Control.Search.extend({

    _makeUniqueKey: function (featureName) {
        return featureName;
    },

    _searchInLayer: function (layer, retRecords, propName) {
        var self = this, loc;
        var key_withUniqueID;

        if (layer instanceof L.Control.Search.Marker) return;

        if (layer instanceof L.Marker || layer instanceof L.CircleMarker) {
            if (self._getPath(layer.options, propName)) {
                loc = layer.getLatLng();
                loc.layer = layer;
                retRecords[self._getPath(layer.options, propName)] = loc;
            }
            else if (self._getPath(layer.feature.properties, propName)) {
                loc = layer.getLatLng();
                loc.layer = layer;
                key_withUniqueID = this._makeUniqueKey(self._getPath(layer.feature.properties, propName));
                retRecords[key_withUniqueID] = loc;
            }
            else {
                //throw new Error("propertyName '"+propName+"' not found in marker");
                console.warn("propertyName '" + propName + "' not found in marker");
            }
        }
        else if (layer instanceof L.Path || layer instanceof L.Polyline || layer instanceof L.Polygon) {
            if (self._getPath(layer.options, propName)) {
                loc = layer.getBounds().getCenter();
                loc.layer = layer;
                retRecords[self._getPath(layer.options, propName)] = loc;
            }
            else if (self._getPath(layer.feature.properties, propName)) {
                loc = layer.getBounds().getCenter();
                loc.layer = layer;
                key_withUniqueID = this._makeUniqueKey(self._getPath(layer.feature.properties, propName));
                retRecords[key_withUniqueID] = loc;
            }
            else {
                //throw new Error("propertyName '"+propName+"' not found in shape");
                console.warn("propertyName '" + propName + "' not found in shape");
            }
        }
        else if (layer.hasOwnProperty('feature'))//GeoJSON
        {
            if (layer.feature.properties.hasOwnProperty(propName)) {

                key_withUniqueID = this._makeUniqueKey(self._getPath(layer.feature.properties, propName));
                if (layer.getLatLng && typeof layer.getLatLng === 'function') {
                    loc = layer.getLatLng();
                    loc.layer = layer;
                    retRecords[key_withUniqueID] = loc;
                } else if (layer.getBounds && typeof layer.getBounds === 'function') {
                    loc = layer.getBounds().getCenter();
                    loc.layer = layer;
                    retRecords[key_withUniqueID] = loc;
                } else {
                    console.warn("Unknown type of Layer");
                }
            }
            else {
                //throw new Error("propertyName '"+propName+"' not found in feature");
                console.warn("propertyName '" + propName + "' not found in feature");
            }
        }
        else if (layer instanceof L.LayerGroup) {
            layer.eachLayer(function (layer) {
                self._searchInLayer(layer, retRecords, propName);
            });
        }
    },
    _defaultMoveToLocation: function (latlng, title, map) {
        if (this.options.zoom)
            this._map.setView(latlng, this.options.zoom);
        else
            this._map.panTo(latlng);

        // add collapse after click on item
        this.collapse();
    },
    _handleAutoresize: function () {
        var maxWidth;

        if (!this._map) {
            this._map = map;
        }

        if (this._input.style.maxWidth !== this._map._container.offsetWidth) {
            maxWidth = this._map._container.clientWidth;

            // other side margin + padding + width border + width search-button + width search-cancel
            maxWidth -= 10 + 20 + 1 + 30 + 22;

            this._input.style.maxWidth = maxWidth.toString() + 'px';
        }

        if (this.options.autoResize && (this._container.offsetWidth + 20 < this._map._container.offsetWidth)) {
            this._input.size = this._input.value.length < this._inputMinSize ? this._inputMinSize : this._input.value.length;
        }
    }
});

function updateSearchControl () {

    setTimeout(function () {
      if (searchControl) {
        try {
          map.removeControl(searchControl);
          searchControl = undefined;
        }
        catch (error) {
          console.error(error);
        }
      }

      // build L.layerGroup of available POI layers
      var featureLayers = [];

      for (var layerEntry of layerControl._layers) {
        if (layerEntry) {
          if (layerEntry.overlay) {
            if (map.hasLayer(layerEntry.layer)) {
                featureLayers.push(layerEntry.layer);
            }

          }
        }
      }

      var layerGroup;
      // if no relevant layers are currently displayed, then
      if (featureLayers.length === 0) {
        searchControl = new MultipleResultsLeafletSearch({
        });
        searchControl.addTo(map);
      }
      else {
        layerGroup = L.featureGroup(featureLayers);

        searchControl = new MultipleResultsLeafletSearch({
          position: "topleft",
          layer: layerGroup,
          initial: false,
          propertyName: property_company,
          textPlaceholder: "Firmen nach Name und Eigenschaften filtern",
          textCancel: "Abbrechen",
          textErr: "Position nicht gefunden",
          hideMarkerOnCollapse: true,
          zoom: 15,
          autoResize: true,
          autoCollapse: false,
          autoType: true,
          formatData: function (json) {	//adds coordinates to name.
            var propName = this.options.propertyName,
              propLoc = this.options.propertyLoc,
              i, jsonret = {};
            if (L.Util.isArray(propLoc))
              for (i in json) {
                if (!this._getPath(json[i], propName)) continue;
                jsonret[this._getPath(json[i], propName) + " (" + json[i][propLoc[0]] + "," + json[i][propLoc[1]] + ")"] = L.latLng(json[i][propLoc[0]], json[i][propLoc[1]]);
              }
            else
              for (i in json) {
                if (!this._getPath(json[i], propName)) continue;
                jsonret[this._getPath(json[i], propName) + " (" + json[i][propLoc][0] + "," + json[i][propLoc][1] + ")"] = L.latLng(this._getPath(json[i], propLoc));
              }
            return jsonret;
          },
          filterData: function (text, records) {
            var I, icase, regSearch, frecords = {};

            text = text.replace(/[.*+?^${}()|[\]\\]/g, '');  //sanitize remove all special characters
            if (text === '')
              return [];

            I = this.options.initial ? '^' : '';  //search only initial text
            icase = !this.options.casesensitive ? 'i' : undefined;

            regSearch = new RegExp(I + text, icase);

            for (var key in records) {

              // make a searchable string from all relevant feature properties
              let recordString = "";
              let record = records[key];
              let recordProperties = record.layer.feature.properties;

              for (const propertyKey in recordProperties) {
                if(recordProperties[propertyKey]){
                  recordString += recordProperties[propertyKey];
                }
              }

              if (regSearch.test(recordString))
                frecords[key] = records[key];
            }

            return frecords;
          },
          buildTip: function (text, val) {
            var emString = "";

            if (val.layer.feature) {
              if (val.layer.styleClass) {
                emString += '<i style="width:14px;height:14px;float:left;" class="icon icon-' + val.layer.styleClass + '">';
                emString += '</i>';
              }
            }
            else {
              emString += "<i style='font-size:1.0em;' class='fas fa-sitemap'></i>";
            }
            return '<a href="" class="search-tip">' + emString + '&nbsp;&nbsp;' + text + '</a>';
          }
        });

        searchControl.addTo(map);
      }
    }, 200);
  };

function initControls() {

    if (map) {
        // zoom control as default

        // attribution control - static suffix
        map.attributionControl.addAttribution("Hochschule Bochum");

        // scale control
        L.control.scale(
            { maxWidth: 500, metric: true, imperial: false }
        ).addTo(map);

        // layerControl
        var baseLayers = {};
        var overlayLayers = {};
        layerControl = L.control.layers(baseLayers, overlayLayers);
        layerControl.addTo(map);

        /////////////////////////////////////////////////////
        ///// LEAFLET SEARCH SETUP
        /////////////////////////////////////////////////////
        // will be updated once example indicator layer is loaded
        searchControl = new MultipleResultsLeafletSearch({
        });
        searchControl.addTo(map);
    }

}

function initBackgroundLayers() {

    if (map && layerControl) {
        // specify all background WMS layers
        // only OSM as active layer

        // start layer

        var osmLayer_tiled =
            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',
                { attribution: 'OSMTiles' }).addTo(map);

        // add baseLayers to Base Layers in layer control
        layerControl.addBaseLayer(osmLayer_tiled, "Open Street Map");
    }
}

function onEachFeature(feature, layer) {
    if (feature.properties) {
        let html = "<div class='table-responsive'><table class='table table-striped table-sm'>";

        html += "<thead>"

        html += "<tr>";
        html += "<th><b>Attributname</b></th>"
        html += "<th><b>Wert</b></th>"
        html += "</tr>";

        html += "</thead>"
        html += "<tbody>"

        for (const key in feature.properties) {
            if (Object.hasOwnProperty.call(feature.properties, key)) {
                const element = feature.properties[key];
                html += "<tr>";
                html += "<td>" + key + "</td>"
                html += "<td>" + element + "</td>"
                html += "</tr>";
            }
        }

        html += "</tbody>"
        html += "</table></div>";

        layer.bindPopup(html);
    }
    else {
        layer.bindPopup("No properties found");
    }
}

function pointToLayer(feature, latlng, styleClass) {

    const fontAwesomeIcon = L.divIcon({
        html: '<i class="fa-solid fa-location-dot fa-2xl"></i>',
        iconSize: [20, 20],
        className: styleClass
    });

    let marker = L.marker(latlng, { icon: fontAwesomeIcon })
    marker.feature = feature;
    marker.styleClass = styleClass;

    return marker;
};

var addPoiMarker = function (markers, poiMarker) {

    // var propertiesString = "<pre>" + JSON.stringify(poiMarker.feature.properties, null, ' ').replace(/[\{\}"]/g, '') + "</pre>";

    let company_name = poiMarker.feature.properties[property_company];
    // delete poiMarker.feature.properties[property_company];

    let street = poiMarker.feature.properties[property_street];
    delete poiMarker.feature.properties[property_street];

    let city = poiMarker.feature.properties[property_city];
    delete poiMarker.feature.properties[property_city];

    let postcode = poiMarker.feature.properties[property_postcode];
    delete poiMarker.feature.properties[property_postcode];

    let adressValue = street + ", " + postcode + ", " + city;
    poiMarker.feature.properties[property_address] = adressValue;

    let moodlePageIdValue = poiMarker.feature[moodlePageId];
    if (moodlePageIdValue && moodlePageIdValue != "") {
        poiMarker.feature.properties[moodlePageId_label] = "<a target='_blank' rel='noreferrer noopener' href=" + moodlePageId_baseUrl + moodlePageIdValue + ">" + moodlePageId_baseUrl + moodlePageIdValue + "</a>";
    }

    var popupContent = '<div class="featurePropertyPopupContent"><table class="table table-condensed">';
    for (var p in poiMarker.feature.properties) {
        popupContent += '<tr><td><b>' + p + '</b></td><td>' + poiMarker.feature.properties[p] + '</td></tr>';
    }
    popupContent += '</table></div>';

    poiMarker.bindPopup("<b><i>" + company_name + "</i></b>" + "<br><br>" + popupContent);

    markers.addLayer(poiMarker);

    return markers;
};

function addLeafletOverlay(geoJSON, title, styleClass) {
    if (map && layerControl) {


        var markers;
        if (useCluster) {
            markers = L.markerClusterGroup({
                iconCreateFunction: function (cluster) {
                    var childCount = cluster.getChildCount();

                    var c = 'marker-cluster-';
                    if (childCount < 5) {
                        c += 'small';
                    } else if (childCount < 10) {
                        c += 'medium';
                    } else {
                        c += 'large';
                    }

                    var className = "marker-cluster " + c + " bg-" + styleClass;

                    //'marker-cluster' + c + ' ' +
                    return new L.DivIcon({ html: '<div class="bg-' + styleClass + '" ><span>' + childCount + '</span></div>', className: className, iconSize: new L.Point(40, 40) });
                }
            });
        }
        else {
            markers = L.layerGroup();
        }

        geoJSON.features.forEach(function (poiFeature) {
            // index 0 should be longitude and index 1 should be latitude
            //.bindPopup( poiFeature.properties.name )
            let latLng = [poiFeature.geometry.coordinates[1], poiFeature.geometry.coordinates[0]];
            var newMarker = pointToLayer(poiFeature, latLng, styleClass)

            markers = addPoiMarker(markers, newMarker);
        });

        markers.addTo(map);
        layerControl.addOverlay(markers, title);
        overlayLayersArray.push(markers);
    }
}


function loadLayers(geoJSON) {
    let geoJSON_surveilling = JSON.parse(JSON.stringify(geoJSON));
    let geoJSON_geoinformatics = JSON.parse(JSON.stringify(geoJSON));
    let geoJSON_careerDay = JSON.parse(JSON.stringify(geoJSON));

    // study is an array. so multiple studies may be specified
    // hence query the array if it includes the respective array
    let features_surveilling = geoJSON_surveilling.features.filter(feature => feature.label.study.includes(study_surveilling));
    let features_geoinformatics = geoJSON_geoinformatics.features.filter(feature => feature.label.study.includes(study_geoinformatics));
    let features_careerDay = geoJSON_careerDay.features.filter(feature => feature[moodlePageId] && feature[moodlePageId] != "");

    geoJSON_surveilling.features = features_surveilling;
    geoJSON_geoinformatics.features = features_geoinformatics;
    geoJSON_careerDay.features = features_careerDay;

    if (features_surveilling.length > 0) {
        addLeafletOverlay(geoJSON_surveilling, label_layer_surveilling, style_class_surveilling);
    }
    if (features_geoinformatics.length > 0) {
        addLeafletOverlay(geoJSON_geoinformatics, label_layer_geoinformatics, style_class_geoinformatics);
    }
    if (features_careerDay.length > 0) {
        addLeafletOverlay(geoJSON_careerDay, label_layer_careerDay, style_class_careerDay);
    }


}

function clearOverlays() {
    for (const layer of overlayLayersArray) {
        layerControl.removeLayer(layer);
        map.removeLayer(layer);
    }
}

function initOverlays() {
    if (map && layerControl) {
        // specify all overlay layers

        clearOverlays();

         loadLayers(geoJSON);

    }
}

function initMap() {
    // map = L.map(mapContainerNodeId).setView([51.461372, 7.2418863], 6);
    map = L.map(mapContainerNodeId).setView([51.3149725, 9.3905754], 6);

    initControls();

    initBackgroundLayers();

    initOverlays();

    updateSearchControl();
}

function toggleClusterDisplay(event) {
    let clusterSwitch = document.getElementById(clusterToggleSwitchId);

    if (clusterSwitch.checked === true || clusterSwitch.checked === 'checked') {
        useCluster = true;
    }
    else {
        useCluster = false;
    }

    initOverlays();
}

function initClusterSwitch() {
    let clusterSwitch = document.getElementById(clusterToggleSwitchId);
    clusterSwitch.checked = true;
    clusterSwitch.checked = "checked";

    clusterSwitch.addEventListener("change", toggleClusterDisplay);
}

function onDomLoaded() {
    initMap();

    initClusterSwitch();
}

document.addEventListener("DOMContentLoaded", onDomLoaded);
    </script>